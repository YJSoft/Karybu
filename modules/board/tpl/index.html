<include target="header.html" />
<!--TODO-->
<div cond="$XE_VALIDATOR_MESSAGE && $XE_VALIDATOR_ID == ''" class="message {$XE_VALIDATOR_MESSAGE_TYPE}">
	<p>{$XE_VALIDATOR_MESSAGE}</p>
</div>
<include target="../../admin/tpl/common/include.grid.html" />
<include target="../../admin/tpl/common/include.paging.html" />
<span class="pull-right">
    <a class="btn btn-primary" href="{getUrl('act','dispBoardAdminInsertBoard','module_srl','')}">{$lang->cmd_create_board}</a>
    <a class="btn _manage_selected" href="#manageSelectedModule">{$lang->cmd_manage_selected_board}</a>
</span>

<div class="clearfix"></div>

<form action="" class="search input-append center clearfix" no-error-return-url="true">
	<input loop="$param => $key, $val" cond="!in_array($key, array('mid', 'vid', 'act', 'page'))" type="hidden" name="{$key}" value="{$val}" />
	<select cond="count($module_category)" name="module_category_srl" title="{$lang->module_category}" style="margin-right:4px">
		<option value="0" selected="selected"|cond="$module_category_srl==='0'">{$lang->not_exists}</option>
		<option value="{$key}" loop="$module_category => $key,$val"  selected="selected"|cond="$module_category==$key">{$val->title}</option>
	</select>
	<select name="search_target" title="{$lang->search_target}" style="margin-right:4px">
		<option value="mid" selected="selected"|cond="$search_target=='mid'">{$lang->mid}</option>
		<option value="browser_title" selected="selected"|cond="$search_target=='browser_title'">{$lang->browser_title}</option>
	</select>
	<input type="search" required name="search_keyword" value="{htmlspecialchars($search_keyword)}" />
	<button type="submit" class="btn btn-inverse">{$lang->cmd_search}</button>
	<a class="btn" href="{getUrl('', 'module', $module, 'act', $act)}">{$lang->cmd_cancel}</a>
</form>

{$selected_manage_content}

<script>
jQuery(function($){
	// Modal anchor activation
    var $docTable = $('#boardList');
    $('input[data-name=cart]').on('change', function(){
        var val = this.checked;
        $docTable.find(':checkbox').each(function(){
            if (val){
                $(this).attr('checked', 'checked');
            }
            else{
                $(this).removeAttr('checked');
            }
        })
    })
	$docTable.find(':checkbox').change(function(){
		var $modalAnchor = $('a._manage_selected');
		if($docTable.find('tbody :checked').length == 0){
			$modalAnchor.removeAttr('href').addClass('disabled');
		} else {
			$modalAnchor.attr('href','#manageSelectedModule').removeClass('disabled');
		}
	}).change();
	// Button action
	$('a._manage_selected').click(function(){
		if($docTable.find('tbody :checked').length == 0){
			//$('body').css('overflow','auto');
			alert('{$lang->choose_board_instance}');
			return false;
		}
        else{
            $('#manageSelectedModule').modal('show');
            var $selectedModule = $('input[type=checkbox].selectedModule:checked');
            var $selectedBody = $('#manageSelectedModuleBody');

            if (!$selectedModule.length) return false;

            $selectedBody.empty();

            var module_srls = new Array();
            $selectedModule.each(function(){
                var $this = $(this);
                var row = '<tr><td>' + $this.data('mid') + '</td><td>' + $this.data('browser_title') + '</td></tr>';
                $selectedBody.append(row);
                module_srls.push($this.val());
            });

            $('#manageSelectedModuleSetup input[name=module_srls]').val(module_srls);
            $('#manageSelectedModuleAddition input[name=target_module_srl]').val(module_srls);
            $('#manageSelectedModuleGrant input[name=module_srls]').val(module_srls);
        }
	});
});
</script>